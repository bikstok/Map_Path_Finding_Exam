<!DOCTYPE html>
<html>
<head>
  <title>Storkøbenhavn Korteste Vej Finder</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>#map{height:600px;width:100%;}</style>
</head>
<body>
  <h2>Klik to punkter for at finde ruten i Storkøbenhavn</h2>
  <div id="map"></div>

  <script>
    const map = L.map('map').setView([55.676,12.558],12); // Storkøbenhavn
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);

    let clicks = [];
    let markers = [];

    map.on('click', e=>{
      clicks.push(e.latlng);

      // Tilføj markør for klik
      const marker = L.marker(e.latlng).addTo(map);
      markers.push(marker);

      if(clicks.length === 2){
        fetch('/api/route',{
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({
            startLat: clicks[0].lat,
            startLng: clicks[0].lng,
            endLat: clicks[1].lat,
            endLng: clicks[1].lng
          })
        })
        .then(res => res.json())
        .then(data => {
          if(!data || !data.path){
            alert('Ingen rute fundet!');
            cleanup();
            return;
          }

          const route = data.path.map(n=>{
            const [lat,lng] = n.split(',').map(Number);
            return [lat,lng];
          });

          // Tegn ruten
          L.polyline(route,{color:'red',weight:5}).addTo(map);

          alert(`Rute fundet! Besøgte noder: ${data.visitedNodes.length}`);
          cleanup();
        });
      }
    });

    // Fjern markører og klik-array
    function cleanup(){
      clicks = [];
      markers.forEach(m => map.removeLayer(m));
      markers = [];
    }
  </script>
</body>
</html>
